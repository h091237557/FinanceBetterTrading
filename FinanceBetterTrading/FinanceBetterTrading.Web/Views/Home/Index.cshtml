@{
    ViewBag.Title = "Home Page";
}

<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>ECharts</title>
</head>
<body>
    <div>
        <input type="text" class="form-control" name="code" id="code" value="3514" />
        <input type="submit" class="btn btn-success" name="getdata" id="getdata" />
    </div>
    <div id="main" style="height:400px"></div>


</body>

@section scripts
{
<script src="~/TypeScript/file1.js"></script>
<script src="~/Scripts/Echart/echarts.js"></script>
<script type="text/javascript">

    $(function () {
  
        $("#getdata").click(function () {          
            $.ajax({
                url: '@Url.Action("GetStockPrice","Home")',
                data: {
                    code:$("#code").val()
                },
                type: "POST",
                success: function (data) {
                    var kline = new KLine();
                    kline.GetData(data);
                    price = kline.pricedata;
                    date = kline.timedata;
                    title = kline.title;
                    echartrequeir(price, date);
                },

                error: function (xhr, ajaxOptions, thrownError) {
                    alert(xhr.status);
                    alert(thrownError);
                }
            });
        });

        function echartrequeir(price, date) {
            // 路径配置
            require.config({
                paths: {
                    echarts: '../Scripts/Echart/dist'
                }
            });

            // 使用
            require(
                [
                    'echarts',
                    'echarts/chart/k' //資料夾位置
                ],
                function (ec) {
                    // 基于准备好的dom，初始化echarts图表
                    var myChart = ec.init(document.getElementById('main'));

                    var option = {
                        title: {
                            text: title
                        },
                        tooltip: {
                            trigger: 'axis',
                            formatter: function (params) {
                                var res = params[0].seriesName + ' ' + params[0].name;
                                res += '<br/>  开盘 : ' + params[0].value[0] + '  最高 : ' + params[0].value[3];
                                res += '<br/>  收盘 : ' + params[0].value[1] + '  最低 : ' + params[0].value[2];
                                return res;
                            }
                        },
                        legend: {
                            data: [title]
                        },
                        toolbox: {
                            show: true,
                            feature: {
                                mark: { show: true },
                                dataZoom: { show: true },
                                dataView: { show: true, readOnly: false },
                                magicType: { show: true, type: ['line', 'bar'] },
                                restore: { show: true },
                                saveAsImage: { show: true }
                            }
                        },
                        dataZoom: {
                            show: true,
                            realtime: true,
                            start: 50,
                            end: 100
                        },
                        xAxis: [
                            {
                                type: 'category',
                                boundaryGap: true,
                                axisTick: { onGap: false },
                                splitLine: { show: false },
                                data: date
                            }
                        ],
                        yAxis: [
                            {
                                type: 'value',
                                scale: true,
                                boundaryGap: [0.01, 0.01]
                            }
                        ],
                        series: [
                            {
                                name: title,
                                type: 'k',
                                data: price
                            }
                        ]
                    };


                    // 为echarts对象加载数据
                    myChart.setOption(option);
                }
            );
        }

       

    });


</script>
}

